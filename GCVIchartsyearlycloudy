
// *Import Intervention Fields Polygons table here*

// Google Earth Engine Script //

var s2 = ee.ImageCollection("COPERNICUS/S2").filterDate(ee.Date("2017-03-29"), ee.Date("2019-03-29")); // Sentinel-2

// formula for GCVI
var withGCVI = s2.filterBounds(table).map(function(image) {
  var nir = image.select('B8');
  var green = image.select('B3');
  var gcvi = (nir.divide(green)).subtract(1).rename('GCVI');
  return image.addBands(gcvi);
});


// print chart of GCVI over time
print(ui.Chart.image.series({
  imageCollection: withGCVI.select('GCVI'),
  region: table,
  reducer: ee.Reducer.median(), // median GCVI value
  scale: 30
}).setOptions({title: 'GCVI over time'}));

// Define a chart with one series in the forest region, averaged by DOY.
var series1 = ui.Chart.image.doySeries(
    withGCVI.select('GCVI'), table, ee.Reducer.median(), 30);

// Define a chart with a a different series for each year in the region.
var series2 = ui.Chart.image.doySeriesByYear(
    withGCVI, "GCVI", table, ee.Reducer.mean(), 30);

// Define a chart with different series for each region, averaged by DOY.
var series3 = ui.Chart.image.doySeriesByRegion(
    withGCVI, "GCVI", table, ee.Reducer.median(), 30, ee.Reducer.mean(), 'label');


//create cloudy pixel percentage band for each image in collection
var addcpp = s2.filterBounds(table).map(function(image){
var doy = ee.Number(image.get('CLOUDY_PIXEL_PERCENTAGE'));
var bandcpp = image.select('B8').multiply(0).eq(0).multiply(doy).rename('CLOUDY_PIXEL_PERCENTAGE');
return image.addBands(bandcpp);
});

// Define a chart with a a different series for each year in the region.
var series4 = ui.Chart.image.doySeriesByYear(
    addcpp, "CLOUDY_PIXEL_PERCENTAGE", table, ee.Reducer.mean(), 30);


// Display the four charts.
print(series1, series2, series3, series4);
